@using pous.Models
@model List<Data>
@{
    ViewData["Title"] = "Google Maps Page";
}

<div class="text-center">
    <div>
        <h1>Google Map</h1>
        <a href="https://mapsplatform.google.com/pricing/?authuser=1" target="_blank">Pricing</a>
        <a href="https://console.cloud.google.com/getting-started?authuser=1" target="_blank"> | Learn API</a>
        <br />
        <div id ="map"  style="border:black; border-width:1px; border-style:solid;" ></div>
        <button type="button" class="btn btn-info btn-lg" id = "continue">Continue</button>
    </div>
</div>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAXkPP9u2NJMjVncw2QLrSew1WeOA_a1zU&callback=initMap"></script>
    <script>
        var x = document.getElementById("map");
        let map, infoWindow;
        function initMap() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        };

                        map = new google.maps.Map(document.getElementById("map"), {
                            center: pos,
                            zoom: 16,
                        });

                        marker = new google.maps.Marker({
                            map,
                            draggable: true,
                            animation: google.maps.Animation.DROP,
                            position: pos,
                        });
                        marker.addListener("click", toggleBounce);
                        $( "#continue" ).click(function() {
                            $.post('/Home/Placeload',  // url
                            { lat: marker.getPosition().lat(), lng: marker.getPosition().lng() },
                            function(){
                                var urlToRedirect= "@Url.Action("Place","Home")";
                                window.location.href = urlToRedirect;
                            })
                        });
                    },
                    () => {
                    handleLocationError(true, infoWindow, map.getCenter());
                    }
                );
            } else {
            handleLocationError(false, infoWindow, map.getCenter());
            }
        }

        function toggleBounce() {
            if (marker.getAnimation() !== null) {
                marker.setAnimation(null);
            } else {
                marker.setAnimation(google.maps.Animation.BOUNCE);
            }
        }
    </script>